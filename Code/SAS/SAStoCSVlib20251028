%macro export_lib(lib=WORK, outdir=C:\exports, replace=YES);
  %let libup = %upcase(&lib);

  proc sql noprint;
    select memname
      into :dsns separated by '|'
    from dictionary.tables
    where libname="&libup" and memtype='DATA';
  quit;

  %if %length(&dsns)=0 %then %do;
    %put NOTE: No datasets found in library &lib;
    %return;
  %end;

  %if %sysfunc(fileexist(&outdir)) = 0 %then %do;
    options noxwait noxsync;
    %sysexec mkdir "&outdir";
  %end;

  %let i = 1;
  %do %while(%scan(&dsns, &i, '|') ne );
    %let ds = %scan(&dsns, &i, '|');
    %let outfile = &outdir\&ds..csv;

    %if %upcase(&replace)=YES %then %let _rep=replace; %else %let _rep=;

    proc export data=&lib..&ds
                outfile="&outfile"
                dbms=csv
                &_rep;
    run;

    %let i = %eval(&i + 1);
  %end;
%mend export_lib;

/* Example usage */
%export_lib(lib=MYLIB, outdir=C:\exports, replace=YES);
